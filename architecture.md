- hypothetical telecom company called S2-cellular (S2C)
    - S2C sells unlimited 5G data plans for a very low fixed price
    - in exchange, subscriber's provide access to some of their data through the device: location, web requests, purchases
    - S2C uses this data to deliver targeted just-in-time offers on subscriber devices
    - S2C powers this with SingleStore
- S2C tracks their cell subscribers in realtime
    - collected via three streams (locations, requests, purchases)
        - locations records the geospatial location of each subscriber
        - requests records the sites each subscriber visits
        - purchases records each purchase a subscribe makes using their device (i.e. via monitoring apple pay, google pay)
    - ingested into SingleStore using pipelines
        - full history stored in location/web/purchase history tables
        - update subscribers table's current location field
            - may be possible to remove this field
- SingleStore schema
    - subscribers (rowstore)
        - each row represents one of S2C's subscribers
        - subscriber id
        - current location (latitude and longitude)
        - last notification time
    - location history
        - subscriber id
        - timestamp
        - location (latitude and longitude)
    - web history
        - subscriber id
        - timestamp
        - domain
    - purchase history
        - subscriber id
        - timestamp
        - vendor
    - customers
        - each row represents a S2C customer who buys offers
        - customer id
        - company name
    - offers
        - customer id
        - offer id
        - enabled
        - notification zone
            - geospatial polygon representing the targeted area
        - notification criteria
            - purchase at <company> within last <day, week, month, forever>
            - visited <polygon> within last <day, week, month, forever>
            - visited <domain> within last <day, week, month, forever>
        - notification content
            - content of the notification
        - notification target
            - which URL to send the subscriber to
        - maximum bid price
            - highest amount this offer is willing to pay per notification
    - notifications
        - offer id
        - subscriber id
        - cost
        - timestamp
- S2C provides an API on top of SingleStore
    - create offer
    - disable offers
        - set enabled = false where offer_id in <list of ids>
    - enable offers
        - set enabled = true where offer_id in <list of ids>
    - offer report
        - input
            - customer id
            - offer id
            - search
                - search for offers with notification content matching this FTS query
            - enabled: true/false/all
            - limit
            - sort field: (any output field)
            - sort order: asc/desc
        - output: one row per matching offer
            - customer id
            - offer id
            - enabled
            - number of notifications
            - total spend
            - min/max/avg spend per notification
- we run the matching algorithm which triggers notifications via writing to a notification table as we load subscriber location updates
    - offers join subscribers
        - offers.enabled = true
        - offers.notification zone = subscribers.current location
        - subscriber.last notification is before XX minutes ago
    - result join notifications
        - filter out any (offer id, subscriber id) which has a notification within the last day
    - result join <locations, purchases, requests> on offer criteria
        - at scale, we may need to compute active criteria in a separate background process and cache if this join is too expensive
    - window to find offer with highest bid per subscriber
    - insert into notifications table and update subscribers table
- a job service would poll the notification table to deliver notifications to subscribers
    - this can be discussed, but not actually built in the demo